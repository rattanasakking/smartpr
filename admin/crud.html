<!DOCTYPE html>
<html lang="th">
<head>
    <link rel="icon" href="https://uppic.retc.ac.th///uploads/691134e447aad.ico" type="image/x-icon" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö AI</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Kanit:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="dashboard-page">

    <div class="offcanvas-lg offcanvas-start sidebar-nav p-3" tabindex="-1" id="sidebar" aria-labelledby="sidebarLabel">
        <div class="offcanvas-header">
            <a href="dashboard.html" class="d-flex align-items-center text-white text-decoration-none">
                <img src="https://uppic.retc.ac.th/uploads/690dedd77a750.png" alt="Logo" class="sidebar-logo me-2">
                <span class="fs-4">Admin Panel</span>
            </a>
            <button type="button" class="btn-close btn-close-white d-lg-none" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body d-flex flex-column">
            <hr class="text-white">
            <ul class="nav nav-pills flex-column mb-auto">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="bi bi-speedometer2 me-2"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="crud.html" class="nav-link active">
                        <i class="bi bi-chat-left-dots me-2"></i> ‡∏ñ‡∏≤‡∏° ‡∏ï‡∏≠‡∏ö AI
                    </a>
                </li>
                <li>
                    <a href="lastquetion.html" class="nav-link">
                        <i class="bi bi-clock-history me-2"></i> ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
                    </a>
                </li>
                <li>
                    <a href="user.html" class="nav-link">
                        <i class="bi bi-people me-2"></i> User
                    </a>
                </li>
                <li>
                <li>
                    <a href="https://smartpr.retc.ac.th/admin/stayin.html"  class="nav-link" target="_blank">
                        <i class="bi bi-line me-2"></i> ‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏° LINE Office
                    </a>
                </li>
                <li>
                    <a href="https://connext.aisdevio.ais.th" class="nav-link" target="_blank">
                        <i class="bi bi-broadcast me-2"></i> Beacon
                    </a>
                </li>
                <li>
                    <a href="https://uppic.retc.ac.th" class="nav-link" target="_blank">
                        <i class="bi bi-upload me-2"></i> ‡∏≠‡∏±‡∏û‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                    </a>
                </li> 
                <li>
                    <a href="https://manager.line.biz/" class="nav-link" target="_blank">
                        <i class="bi bi-line me-2"></i> LINE OA
                    </a>
                </li>
            </ul>
            <hr class="text-white">
            <a href="#" id="logoutButton" class="nav-link logout-link">
                <i class="bi bi-box-arrow-right me-2"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
            </a>
        </div>
    </div>

    <div class="main-content">
        
        <nav class="navbar header-navbar sticky-top d-lg-none">
            <div class="container-fluid">
                <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar" aria-controls="sidebar">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <a class="navbar-brand" href="crud.html">‡∏ñ‡∏≤‡∏° ‡∏ï‡∏≠‡∏ö AI</a>
            </div>
        </nav>

        <main class="container-fluid p-4">
            <h1 class="mb-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö AI</h1>

            <div class="card mb-4">
                <div class="card-header"><h3 id="formTitle">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡∏°‡πà</h3></div>
                <div class="card-body">
                    <form id="createForm">
                        <div class="mb-3">
                            <label for="awsner" class="form-label">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label>
                            <input type="text" class="form-control" id="awsner" required>
                        </div>
                        <div class="mb-3">
                            <label for="content" class="form-label">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</label>
                            <input type="text" class="form-control" id="content" placeholder="‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°..." required>
                        </div>
                        <div class="mb-3">
                            <label for="type" class="form-label">‡∏ä‡∏ô‡∏¥‡∏î</label>
                            <select class="form-select" id="type" required>
                                <option value="text" selected>Text</option>
                                <option value="image">Image</option>
                            </select>
                        </div>
                        <input type="hidden" id="editModeId" value="">
                        <button type="submit" class="btn btn-primary" id="submitButton">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button type="button" class="btn btn-secondary d-none" id="cancelEditButton">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                    </form>
                </div>
            </div>

            <hr class="my-4">
            <h3>‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>

            <div class="mb-3">
                <label for="searchInput" class="form-label">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ (‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö):</label>
                <input type="text" class="form-control" id="searchInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
            </div>

            <button id="refreshButton" class="btn btn-info mb-3 text-white">‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà</button>
            
            <div class="card">
                <div class="card-body table-responsive-wrapper"> 
                    <table class="table table-striped table-bordered align-middle" id="dataTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Awsner (‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°)</th>
                                <th>Content (‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö)</th>
                                <th>Type (‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó)</th>
                                <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="data-table-body">
                            <tr><td colspan="5" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <nav aria-label="Page navigation" class="mt-3">
                <ul class="pagination justify-content-center" id="pagination-controls">
                    </ul>
            </nav>

        </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        if (sessionStorage.getItem('isLoggedIn') !== 'true') {
            alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡πà‡∏≠‡∏ô‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô");
            window.location.href = 'login.html';
        }
        
        const API_URL = "https://api.sheety.co/423538c420e6cba4d60e9a41d250224e/chatGpt/traning";
        const SHEET_NAME = "traning"; 
        const form = document.getElementById('createForm');
        const tableBody = document.getElementById('data-table-body');
        const refreshButton = document.getElementById('refreshButton');
        const formTitle = document.getElementById('formTitle');
        const submitButton = document.getElementById('submitButton');
        const cancelEditButton = document.getElementById('cancelEditButton');
        const editModeIdInput = document.getElementById('editModeId');
        const awsnerInput = document.getElementById('awsner');
        const contentInput = document.getElementById('content');
        const typeInput = document.getElementById('type');
        
        let allData = [];
        const searchInput = document.getElementById('searchInput');

        // üü¢ 2. (‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Pagination
        const paginationControls = document.getElementById('pagination-controls');
        let filteredData = []; // ‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
        let currentPage = 1;
        const itemsPerPage = 20; // üëà ‡∏Å‡∏≥‡∏´‡∏ô‡∏î 20 ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏´‡∏ô‡πâ‡∏≤

        
        // üü¢ 3. (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô fetchData ‡πÉ‡∏´‡πâ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö Pagination
        async function fetchData() {
            tableBody.innerHTML = '<tr><td colspan="5" class="text-center">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</td></tr>';
            try {
                const response = await fetch(API_URL);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                
                // (‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏•‡∏≥‡∏î‡∏±‡∏ö‡πÉ‡∏´‡πâ ID ‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î‡∏≠‡∏¢‡∏π‡πà‡∏ö‡∏ô‡∏™‡∏∏‡∏î *‡∏Å‡πà‡∏≠‡∏ô*)
                allData = (data[SHEET_NAME] || []).sort((a, b) => b.id - a.id);
                filteredData = allData; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÉ‡∏´‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß = ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
                currentPage = 1; // ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ 1 ‡πÄ‡∏™‡∏°‡∏≠
                displayPage(currentPage); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤ 1
                
            } catch (error) {
                console.error('Error fetching data:', error);
                tableBody.innerHTML = `<tr><td colspan="5" class="text-center">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${error.message}</td></tr>`;
            }
        }

        // üü¢ 4. (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô filterAndRender
        function filterAndRender() {
            const searchTerm = searchInput.value.toLowerCase().trim();

            if (searchTerm === '') {
                filteredData = allData; // ‡∏ñ‡πâ‡∏≤‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ß‡πà‡∏≤‡∏á, ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            } else {
                // ‡∏Å‡∏£‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
                filteredData = allData.filter(row => {
                    const question = row.awsner ? row.awsner.toLowerCase() : '';
                    const answer = row.content ? row.content.toLowerCase() : '';
                    return question.includes(searchTerm) || answer.includes(searchTerm);
                });
            }

            displayPage(1); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏´‡∏ô‡πâ‡∏≤ 1 (‡∏Ç‡∏≠‡∏á‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡∏Å‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß)
        }
        
        // üü¢ 5. (‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏°‡∏´‡∏ô‡πâ‡∏≤
        function displayPage(page) {
            currentPage = page;
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            
            const paginatedItems = filteredData.slice(startIndex, endIndex);
            
            renderTable(paginatedItems); // ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ï‡∏≤‡∏£‡∏≤‡∏á
            renderPagination(); // ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î
        }

        // üü¢ 6. (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô renderTable (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏° ‡πÅ‡∏ï‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° "‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•")
        function renderTable(rows) {
            tableBody.innerHTML = '';
            if (rows.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="text-center">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏´‡∏£‡∏∑‡∏≠‡∏ú‡∏•‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤)</td></tr>';
                return;
            }
            rows.forEach(row => {
                const tr = document.createElement('tr');
                let contentCellHtml;
                if (row.type === 'image') {
                    contentCellHtml = row.content ? `<img src="${row.content}" alt="Image" class="table-image">` : '(No Image URL)';
                } else {
                    contentCellHtml = row.content ? String(row.content).replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';
                }
                const awsnerHtml = row.awsner ? String(row.awsner).replace(/</g, "&lt;").replace(/>/g, "&gt;") : '';

                tr.innerHTML = `
                    <td>${row.id}</td>
                    <td>${awsnerHtml}</td> 
                    <td>${contentCellHtml}</td>
                    <td>${row.type}</td>
                    <td>
                        <button class="btn btn-warning btn-sm me-1" onclick="handleEdit(${row.id})">
                            <i class="bi bi-pencil-square"></i>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="handleDelete(${row.id})">
                            <i class="bi bi-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(tr);
            });
        }
        
        // üü¢ 7. (‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏° Pagination (‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏à‡∏≤‡∏Å pending.html)
        function renderPagination() {
            paginationControls.innerHTML = ''; 
            const totalPages = Math.ceil(filteredData.length / itemsPerPage);

            if (totalPages <= 1) return; 

            // (Previous Button)
            const prevLi = document.createElement('li');
            prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
            prevLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage - 1}">‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</a>`;
            paginationControls.appendChild(prevLi);

            // (Numeric Buttons logic)
            const maxPagesToShow = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
            let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
            if (endPage - startPage < maxPagesToShow - 1) {
                startPage = Math.max(1, endPage - maxPagesToShow + 1);
            }
            if (startPage > 1) {
                const firstLi = document.createElement('li');
                firstLi.className = 'page-item';
                firstLi.innerHTML = `<a class="page-link" href="#" data-page="1">1</a>`;
                paginationControls.appendChild(firstLi);
                if (startPage > 2) {
                     paginationControls.innerHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            for (let i = startPage; i <= endPage; i++) {
                const pageLi = document.createElement('li');
                pageLi.className = `page-item ${i === currentPage ? 'active' : ''}`;
                pageLi.innerHTML = `<a class="page-link" href="#" data-page="${i}">${i}</a>`;
                paginationControls.appendChild(pageLi);
            }
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    paginationControls.innerHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
                const lastLi = document.createElement('li');
                lastLi.className = 'page-item';
                lastLi.innerHTML = `<a class="page-link" href="#" data-page="${totalPages}">${totalPages}</a>`;
                paginationControls.appendChild(lastLi);
            }
            
            // (Next Button)
            const nextLi = document.createElement('li');
            nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
            nextLi.innerHTML = `<a class="page-link" href="#" data-page="${currentPage + 1}">‡∏ñ‡∏±‡∏î‡πÑ‡∏õ</a>`;
            paginationControls.appendChild(nextLi);

            // (Event Listeners)
            paginationControls.querySelectorAll('.page-link').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageNum = Number(link.dataset.page);
                    if (pageNum && pageNum !== currentPage) {
                        displayPage(pageNum);
                    }
                });
            });
        }

        // --- (‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠: resetForm, handleEdit, handleDelete, submit ... ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç) ---
        
        function resetForm() {
            form.reset(); 
            editModeIdInput.value = ''; 
            formTitle.innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà';
            submitButton.innerText = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
            submitButton.classList.replace('btn-warning', 'btn-primary'); 
            cancelEditButton.classList.add('d-none');
            contentInput.placeholder = "‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...";
        }
        
        async function handleEdit(id) {
            try {
                // (‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å allData ‡πÄ‡∏£‡πá‡∏ß‡∏Å‡∏ß‡πà‡∏≤)
                const rowData = allData.find(row => row.id === id); 
                if (!rowData) throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID ‡∏ô‡∏µ‡πâ");

                awsnerInput.value = rowData.awsner;
                contentInput.value = rowData.content;
                typeInput.value = rowData.type; 
                updateContentPlaceholder();
                editModeIdInput.value = id;
                formTitle.innerText = `‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ID: ${id}`;
                submitButton.innerText = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•';
                submitButton.classList.replace('btn-primary', 'btn-warning');
                cancelEditButton.classList.remove('d-none'); 
                form.scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                console.error('Error fetching data for edit:', error);
                alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÑ‡∏î‡πâ');
            }
        }
        
        async function handleDelete(id) {
            if (!confirm(`‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ß‡πà‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÅ‡∏ñ‡∏ß ID: ${id}?`)) return;
            try {
                const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                fetchData(); // (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            } catch (error) {
                console.error('Error deleting data:', error);
                alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ' + error.message);
            }
        }
        
        function updateContentPlaceholder() {
            contentInput.placeholder = (typeInput.value === 'image') ? "‡πÇ‡∏õ‡∏£‡∏î‡∏ß‡∏≤‡∏á URL ‡∏Ç‡∏≠‡∏á‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡πÄ‡∏ä‡πà‡∏ô https://...)" : "‡πÇ‡∏õ‡∏£‡∏î‡πÉ‡∏™‡πà‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...";
        }
        
        form.addEventListener('submit', async (event) => {
            event.preventDefault(); 
            const id = editModeIdInput.value;
            const formData = {
                [SHEET_NAME]: {
                    awsner: awsnerInput.value,
                    content: contentInput.value,
                    type: typeInput.value 
                }
            };
            const method = id ? 'PUT' : 'POST';
            const url = id ? `${API_URL}/${id}` : API_URL;
            try {
                const response = await fetch(url, {
                    method: method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                resetForm(); 
                
                // (‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà (‡∏à‡∏≤‡∏Å pending.html)
                const pendingId = sessionStorage.getItem('pendingQuestionId');
                if (pendingId && !id) { 
                    const PENDING_API_URL = "https://api.sheety.co/423538c420e6cba4d60e9a41d250224e/chatGpt/chatGptQuestion";
                    await fetch(`${PENDING_API_URL}/${pendingId}`, { method: 'DELETE' });
                    sessionStorage.removeItem('pendingQuestionId'); 
                }

                fetchData(); // (‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á) ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            } catch (error) {
                console.error(`Error ${method} data:`, error);
                alert(`‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (${method})`);
            }
        });
        
        cancelEditButton.addEventListener('click', resetForm);
        refreshButton.addEventListener('click', fetchData);
        typeInput.addEventListener('change', updateContentPlaceholder);
        
        searchInput.addEventListener('input', filterAndRender);
        
        document.getElementById('logoutButton').addEventListener('click', () => {
            if (confirm("‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?")) {
                sessionStorage.removeItem('isLoggedIn');
                window.location.href = 'login.html';
            }
        });
        
        // üü¢ 8. (‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏≤‡∏á (‡∏à‡∏≤‡∏Å pending.html)
        function checkPendingQuestion() {
            const pendingQuestion = sessionStorage.getItem('pendingQuestion');
            if (pendingQuestion) {
                awsnerInput.value = pendingQuestion;
                form.scrollIntoView({ behavior: 'smooth' });
                sessionStorage.removeItem('pendingQuestion');
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            fetchData();
            checkPendingQuestion(); // (‡πÄ‡∏û‡∏¥‡πà‡∏°) ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        });
    </script>
</body>
</html>